## DFS树

命题：DFS树的任意一个子树中所有点的编号是连续的一段区间。

### 有向图

定义（强连通分量）：

若有向图$G$中的任意两个点能够相互到达，则$G$是强连通图。

图$G$的极大强连通子图是$G$的强连通分量。

注：能够互相到达是一个等价关系。将顶点集商掉这个关系即得到一堆强连通分量。

命题：将$G$的每个强连通分量缩成一个点后得到的是一个DAG。

命题：对于有向图中的任意一个DFS树，可以将图中的边分为三类：

1. 正向边：$u$是$v$的祖先
2. 反向边：$v$是$u$的祖先
3. 横向边：`dfn[u]>dfn[v]`

因为遍历$u$的邻接表时一定能够找到$v$，所以不存在对于某条边$(u,v)$有`dfn[u]<dfn[v]`且$u$不是$v$的祖先的这种情况。

命题：对于$G$中的任意一个强连通分量$H$，设$u,v \in H$，则任意一条$u-v$路上的所有点均属于$H$。

命题：若从$u$出发能够到达$v$且$v$不在以$u$为根的子树中，则任意一条$u-v$路包含至少一个DFS序小于$u$的点。

证明：因为$v$不在以$u$为根的子树中，所以$v$不能从$u$出发仅通过树边到达。因此任意一条$u-v$路包含至少一条反向边或横向边。

考虑任意一条$u-v$路中的第一条离开以$u$为根的子树的边，这条边只会是反向边或横向边。因为DFS树的任意一个子树中点的DFS序连续，所以这条边的终点DFS序小于$u$。

命题：对于$G$中的每一个强连通分量$H$，设其DFS序最小的点为$u$，则$H$中除$u$之外的所有点都在以$u$为根的子树中。

证明：若点$v$属于$H$且不能够仅通过树边到达，则其一定在以$u$为根的子树外。由前两个命题，任意一条$u-v$路都包含一个DFS序小于$u$的点且该点属于$H$，这与$u$的定义矛盾。

考虑对$G$进行DFS并维护一个栈。栈中的点是已经遇到的未确认其所属强连通分量的点。

在DFS过程中每遇到一个未被访问过的点就将其入栈，回溯时若确认其是所属强连通分量中DFS序最小的点，则此时从栈顶一直到这个点构成了一个强连通分量，弹栈并标记。

若一个点不是所属强连通分量中DFS序最小的点，则称其满足性质1。

若点$u$能够通过一条反向边直接抵达一个祖先节点，则称其满足性质2。

若点$u$能够通过树边抵达一个满足性质2的点，则称其满足性质2。



对于某个强连通分量$H$，其中的点可以分为5类。



命题：对于$G$中的每个强连通分量$H$，若一条边$(u,v),u \in H$不是树边且存在边$(u,v'),v' \in H$且$dfn(v') <dfn(v)$则将其删去，则剩下的边构成的图的强连通分量与$G$相同。

证明：首先删边不会形成新的强连通关系。对某个DFS序最小点为$u$的强连通分量$H$，$H\setminus u$中的每个点均能到达$u$。

先考虑一类简单的点，即仅通过一系列树边和一条反向边能够直接到达$u$的点，明显这些点所属的强连通分量不会变。

$H$中一定存在这类点，因为不存在从$H\setminus u$出发的指向$u$的横向边，所以要到达$u$必须经过至少一条反向边。







### 无向图

无向图的DFS树中仅存在树边与非树边。

